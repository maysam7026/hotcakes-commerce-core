@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<Moslem.Modules.GDS.GDSModuleMVC.Controllers.resgetCity>


@using System.Text.RegularExpressions
@using DotNetNuke.Web.Mvc.Helpers
@using DotNetNuke.Framework.JavaScriptLibraries
@using DotNetNuke.Web.Client.ClientResourceManagement

@{
    ClientResourceManager.RegisterStyleSheet(Dnn.DnnPage, "~/desktopmodules/mvc/GDSModuleMVC/kamadatepicker.min.css");
    //  ClientResourceManager.RegisterScript(Dnn.DnnPage, "~/desktopmodules/mvc/GDSModuleMVC/kamadatepicker.min.js");

    //ClientResourceManager.RegisterStyleSheet(Dnn.DnnPage, "~/DesktopModules/MVC/DotNetNuclear/RestaurantMenu/Resources/module.css");
}

<script src="~/desktopmodules/mvc/GDSModuleMVC/kamadatepicker2.min.js"
        type="text/javascript"></script>
<script src="~/desktopmodules/mvc/GDSModuleMVC/content/js/angular.min.js"></script>
<script src="~/desktopmodules/mvc/GDSModuleMVC/content/js/angular-ui-router.min.js"></script>
<script src="~/desktopmodules/mvc/GDSModuleMVC/content/js/AngularFormApp.js"></script>
<style>
    .form-group {
        padding: 0 10px;
    }
</style>
<div ng-app="angularFormsApp" ng-controller="fiftyDiscount">

    <!----   Cyrus  ----->
    <div class="reservationBox">

        <div class="Reserve_Title" style="text-align:center;margin-top:5px;">هتل خود را جستجو و رزرو کنید	</div>
        <div class="Reserve_sep"></div>

        <div class="col-md-12">
            <div class="Reserve_Title">شهر  </div>
            <div class="input-container">
                <div class="icon-ph"><i class="fa fa-globe"></i></div>
                <select id="city">
                    <option value="null">قصد اقامت در چه شهری را دارید؟</option>
                    @foreach (var item in Model.response)
                    {
                        /* if (!string.IsNullOrEmpty(Dnn.LocalizeString(item.description)))
                         { */
                        <option value="@item.id">@item.description</option>
                        //  }

                    }
                </select>
            </div>
        </div>

        <div class="Reserve_sep"></div>


        <div class="col-md-12">
            <div class="Reserve_Title">هتل</div>
            <div class="input-container" typeitem="main_item">
                <div class="icon-ph"><i class="fa fa-building"></i></div>
                <select id="hotel" disabled="true">
                    <option value="null">هتل مورد نظر را انتخاب نمائید</option>
                </select>
            </div>
        </div>


        <div class="Reserve_sep"></div>



        <div class="col-md-6">
            <div class="Reserve_Title">تاریخ ورود</div>
            <div class="input-container">
                <div class="icon-ph"><i class="fa fa-calendar"></i></div>
                <input class="s_drop" type="text" id="dateStart" name="dateStart" placeholder="تاریخ شروع" />
            </div>
        </div>

        <div class="col-md-6">
            <div class="Reserve_Title">تاریخ خروج</div>
            <div class="input-container">
                <div class="icon-ph"><i class="fa fa-calendar"></i></div>
                <input class="s_drop" type="text" id="dateEnd" name="dateEnd" placeholder="تاریخ پایان" />
            </div>
        </div>

        <div class="Reserve_sep"></div>





        <div class="col-md-12">
            <div class="Reserve_Title">تعداد نفرات</div>
            <div class="input-container" typeitem="main_item">
                <div class="icon-ph"><i class="fa fa-users"></i></div>
                <select id="count" class="s_text_box" style="color: rgb(0, 0, 0);">
                    <option value="null">تعداد میهمانان  را انتخاب نمائید</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="5+">5+</option>
                </select>
            </div>
        </div>

        <div class="Reserve_sep"></div>

        <div>
            <div class="col-md-12" style="padding: 10px;" >
                <a id="disbtn" style="width: 100%;" class="btn btn-warning" data-toggle="modal" data-target="#exampleModal" ng-disabled="isDisabled">{{CheckRetiredText}}</a>
            </div>
                <div class="col-md-6">
                    <div class="Reserve_Title" style="margin-top:5px;"><a href="/hotels"> لیست هتل ها</a></div>
                </div>

                <div class="col-md-6">
                    <center>
                        <div style="text-align:left;margin-bottom:5px;" class="s_key" @*onclick="searchitem_hotel_search_start();*@ ">
                            <a id="asdf" class="s_key btn btn-info" onclick="myfunction()">جستجو</a>
                        </div>
                    </center>
                </div>

            </div>

            <div class="Reserve_sep"></div>


        </div>

    <!----   Cyrus  ----->
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">بررسی اطلاعات بازنشتگان</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="col-md-12 form-horizontal" role="form">
                        <div id="pnlgetreireinfo">
                            <div class="form-group">
                                <label for="daftar" class="control-label col-sm-3">شماره دفتر</label>
                                <div class="col-sm-9">
                                    <input type="text" id="daftar" class="form-control" name="daftar" ng-model="daftarNumber" />
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="codemelli" class="control-label col-sm-3">کد ملی :</label>
                                <div class="col-sm-9">
                                    <input type="text" id="codemelli" class="form-control" name="codemelli" ng-model="codemelli" />
                                </div>
                            </div>
                            <div class="alert alert-warning" ng-show="showErrorAlert">
                                <button type="button" class="close" data-ng-click="switchBool('showSuccessAlert')">×</button>
                                <strong>خطا!</strong> {{successTextAlert}}
                            </div>
                            <div class="alert alert-success" ng-show="showSuccessAlert">
                                <button type="button" class="close" data-ng-click="switchBool('showSuccessAlert')">×</button>
                                <strong>تبریک !</strong> {{successTextAlert}}
                            </div>
                            <div class="form-group"  ng-hide="isDisabled">
                                <a style="float:left;" class="btn btn-primary" ng-click="ApplyTakhfif()">
                                    {{CheckText}}
                                </a>
                            </div>

                            <button type="button" class="btn btn-primary" style="float:left;" data-dismiss="modal" ng-show="isDisabled" aria-label="Close" aria-hidden="true">
                                        {{CheckText}}
                            </button>
                            <div id="ResultAfterCreditEnquery">

                            </div>
                        </div>
                    </div>
                    <div class="clear:both;"></div>
                </div>

                <div class="modal-footer">
                    <div class="panel panel-danger" style="margin-bottom:-19px;">
                        <div class="panel-heading">حضور بازنشستگان محترم در هتل </div>
                        <div class="panel-body">Panel Content</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal -->

</div>











<script>

        sf = $.ServicesFramework(@Dnn.ActiveModule.ModuleID)
    function isBlank(data) {
        return ($.trim(data).length == 0 || data == 'null');
    }
    function myfunction() {
        if (isBlank($("#dateStart").val()) || isBlank($("#count").val()) || isBlank($("#count").val()) || isBlank($("#dateStart").val()) || isBlank($("#dateEnd").val()) || $("#city").val() == 'null' || $("#hotel").val() == 'null' || isBlank( $("#hotel").val())) {
            alert("لطفا اطلاعات را کامل نمایید");
            return;
        }
        redirectPost("@ViewBag.Url", { sdate: $("#dateStart").val(), edate: $("#dateEnd").val(), cityid: $("#city").val(), count: $("#count").val(), citytitle: $("#city option:selected").text(), hotelID : $("#hotel").val() })
    }
    function redirectPost(url, data) {
        var form = document.createElement('form');
        document.body.appendChild(form);
        form.method = 'post';
        form.action = url;
        for (var name in data) {
            var input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = data[name];
            form.appendChild(input);
        }
        form.submit();
    }





        $("#city").change(function () {
            $("#hotel").prop("disabled", true);
            $("#hotel").empty()
            $('<option value="null">لطفا صبر کنید</option>').appendTo("#hotel");
                    $.ajax({
                        url: "/DesktopModules/MVC/GDSModuleMVC/GDS/gethotel?cityid=" + $("#city").val(),
                        method: "Get",
                        beforeSend: sf.setModuleHeaders
                    })
                        .done(function (data) {
                            data = JSON.parse(data);
                            var items = [];
                            $("#hotel").empty();
                            $('<option value="null">نام هتل</option>').appendTo("#hotel");
                            $.each(data.aaData, function (key, val) {
                                var div_data = '<option value="' + val.value + '">' + val.text + "</option>";
                                $(div_data).appendTo('#hotel');
                                $("#hotel").prop("disabled", false);
                            });

                        }).error(function () {
       $("#hotel").empty();
            $('<option value="null">شهر دیگری را انتخاب نمایید</option>').appendTo("#hotel");
        });

            });



    //    $.getJSON("/DesktopModules/MVC/GDSModulemvc/GDS/gethotel?cityid=" + $("#city").val()
    //        , function (data) {
    //            data = JSON.parse(data);
    //            var items = [];
    //            $("#hotel").empty();
    //            $('<option value="null">نام هتل</option>').appendTo("#hotel");
    //            $.each(data.aaData, function (key, val) {
    //                var div_data = '<option value="' + val.value + '">' + val.text + "</option>";
    //                $(div_data).appendTo('#hotel');
    //                $("#hotel").prop("disabled", false);
    //            });
    //        }).error(function() {
    //        $("#hotel").empty();
    //            $('<option value="null">شهر دیگری را انتخاب نمایید</option>').appendTo("#hotel");
    //        });
    //});











    $(document).ready(function () {
        function addDay(a) { var r = a.split("/"), n = parseInt(r[0]), t = parseInt(r[1]), e = parseInt(r[2]); 6 >= t ? (t = e + 1 > 31 ? t + 1 : t, e = e + 1 > 31 ? 1 : e + 1) : t >= 7 && 11 >= t ? (t = e + 1 > 30 ? t + 1 : t, e = e + 1 > 30 ? 1 : e + 1) : 12 == t && (e = e + 1 > 29 ? 29 : e + 1), t > 12 && (t = 1, n++); var p = n + "/" + t + "/" + e; return p }

        var datesFrom = $('input[name="dateStart"]').datepicker({
            dateFormat: 'yy/mm/dd',
            isRTL: true,
            minDate: 0,
	    numberOfMonths: ($(window).width() > 640) ? 2 : 1,
            onSelect: function (selectedDate) {
                dateTo.datepicker('option', 'minDate', addDay(selectedDate));
                 $('input[name="dateEnd"]').val(addDay(selectedDate));
            }
        });
        var dateTo = $('input[name="dateEnd"]').datepicker({
            dateFormat: 'yy/mm/dd',
            isRTL: true,
            minDate: 0,
	    numberOfMonths: ($(window).width() > 640) ? 2 : 1,
            onSelect: function (selectedDate) {

            }
        });
    });
</script>
<style>
    .modal-backdrop.fade.in {
        z-index: 100;
    }
</style>